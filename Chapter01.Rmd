---
title: "描述性统计"
author: "梁雪枫"
documentclass: ctexart
output:
  pdf_document:
    fig_caption: yes
    latex_engine: xelatex
    number_sections: yes
    template: !expr rticles::ctex_template()
    toc: yes
classoption: "hyperref`r if (.Platform$OS.type != 'windows') ',nofonts'`"
---

```{r include=FALSE}
library(epicalc)
library(mosaic)
library(showtext)
library(pander)
library(PerformanceAnalytics)
```

统计分析分为统计描述和统计推断两个部分，统计描述是通过绘制统计图、计算统计量等方法描述数据的分布特征，是数据分析的基本步骤。

## 常用统计量

###  均数(Mean)

均数是一组数据的平均值，均数（记为$\overline{x}$）定义为
$$\overline{x} = \frac{\sum_{i=1}^{n}x_{i}}{n}$$
用它来描述正态分布数据的集中趋势。

### 标准差(Standard Deviation)

标准差是方差的算术平方根，是一组数值自均数分散开来的程度的一种测量观念。定义为
$$\delta = \sqrt{\frac{1}{N}\sum_{i=1}^{n}(x_i-u)^2}$$
一个较大的标准差，代表大部分的数值和其平均值之间差异较大；一个较小的标准差，代表这些数值较接近平均值。

例1.已知50名患者的收缩压（mmHg）分别为：
147 163 159 124 120  94 135 185 109 143 116 129 157 146 149 127 124 160 101 129 130 154 151
119 128 147 127 122 145 159 141 131 117 139 142 152 147 157 134 146 144 119 160 136 122 172
170 109 151 144

求血压的集中趋势和离散趋势及集中趋势的95%可信区间。

思路：先判断数据是否为正态分布，然后根据结果选择描述集中趋势的统计量。
```{r}
sbp <- c(147,163,159,124,120,94,135,185,109,143,116,129,157,146,149,127,124,160,101,129,130,154,151,119,128,147,127,122,145,159,141,131,117,139,142,152,147,157,134,146,144,119,160,136 ,122,172,170,109,151,144)
qqnorm(sbp)
qqline(sbp)
#plot(density(sbp)) 核密度
hist(sbp,freq = F) #freq=T,则绘制频数
result <- shapiro.test(sbp)
result
ks.test(sbp,"pnorm",mean(sbp),sd(sbp))
```
样本大小在3和5000之间,选择Shapiro-Wilk进行正态性检验。W值为`r result[1]`，P值为`r result[2]`大于0.05，不能拒绝其于正态分布一致的假设。如果样本数较大，可以选择Kolmogorov-Smirnov检验。对于服从正态分布的数据，选择均数和标准差描述其集中趋势和离散趋势。
```{r}
mean(sbp)
sd(sbp)
```
均值为`r mean(sbp)`,标准差为`r sd(sbp)`。对均数和标准差的计算还可以通过base包中的summary()函数、epicalc包中的summ()和mosaic包中的favstats()等方式获得。如favstats()一次就可以完成均数和标准差的计算。
```{r}
favstats(sbp)
```

对均数的95%可信区间的计算可通过t.test()获得，对一个给定的可信区间，它表示一个总体参数的估计范围。根据中位数和均数可以快速检查数据分布，如中位数小于均数，说明分布有可能向右倾斜。
```{r}
t.test(sbp)
```

通过设置conf.level=0.99，可以将可信区间水平提高到99%。
```{r}
t.test(sbp,conf.level=0.99)
```
###中位数(Median)
对于一组有限个数的数据来说，它们的中位数是这样的一种数：这群数据里的一半的数据比它大，而另外一半数据比它小。 计算有限个数的数据的中位数的方法是：把所有的同类数据按照大小的顺序排列。如果数据的个数是奇数，则中间那个数据就是这群数据的中位数；如果数据的个数是偶数，则中间那2个数据的算术平均值就是这群数据的中位数。通常用中位数来描述非正态分布数据的集中趋势，极值对中位数影响不大。定义为
实数$x_1$, $x_2$, $\dots$, $x_n$按大小顺序（顺序，降序皆可）排列为$x'_1$, $x'_2$, $\dots$ , $x'_n$、实数数列$x=(x_1, x_2, \dots , x_n)$的中位数$\mathrm{Q}_\frac{1}{2}(x)$为
$$\mathrm{Q}_\frac{1}{2}(x) = 
\begin{cases} 
 x'_\frac{n + 1}{2},                                  & \mbox{if } n \mbox{ is odd.} \\
 \frac{1}{2}( x'_\frac{n}{2} + x'_{\frac{n}{2} + 1}), & \mbox{if } n \mbox{ is even.} 
\end{cases}
$$
odd 为奇数，even 为偶数。

###四分位差(quartile deviation)
是上四分位数（QU，即位于75%）与下四分位数（QL，即位于25%）的差的一半。计算公式为：$Qd=QU-QL$。四分位差反映了中间50%数据的离散程度，其数值越小，说明中间的数据越集中；其数值越大，说明中间的数据越分散。四分位差不受极值的影响。
例2. 某地17名患者的月收入分别为：
23408 3468 1939 4360 23545 12233 4583 3546 35781 6578 8981 1345 5567 23455 23564 7623 14334
求收入的集中趋势和离散趋势及集中趋势的95%可信区间。
思路：仍然先判断数据是否为正态分布，然后根据结果选择描述集中趋势的统计量。
```{r}
income <- c(23408,3468,1939,4360,23545,12233,4583,3546,35781,6578,8981,1345,5567,23455, 23564,7623,14334)
qqnorm(income)
qqline(income)
#plot(density(income))
hist(income,freq = F)
result <- shapiro.test(income)
result
```
根据QQ图和Shapiro-Wilk进行正态性检验结果，W值为`r result[1]`，P值为`r result[2]`小于0.05，选择中位数和四分位差描述其集中趋势和离散趋势。
```{r}
quantile(income)
```
中位数为`r median(income)`，四分位差为75%的分位数减去25%的分位数。对中位数的可信区间估计，可通过wilcox.test()函数获得
```{r}
wilcox.test(income, conf.int=TRUE)
```

### 数学期望(mathematical expectation)
离散型随机变量：离散型随机变量的一切可能的取值$x_{i}$与对应的概率$P_{i}(=x_{i})$之积的和称为该离散型随机变量的数学期望，记为$E(X)$。数学期望是最基本的数学特征之一。它反映随机变量平均取值的大小。离散型随机变量的数学期望就是均数，通过mean()即可获得。
$$E(X)=\sum_{i}x_{i}p_{i}$$
连续型随机变量：若随机变量X的分布函数$F(x)$可表示成一个非负可积函数$f(x)$的积分，则称$X$为连续性随机变量，$f(x)$称为$X$的概率密度函数，积分值为X的数学期望，记为$E(X)$。
$$E(X)=\int_{-\infty }^{+\infty }xf(x)dx$$

###方差(Variance)
方差是各个数据与平均数之差的平方的平均数。在概率论和数理统计中，方差用来度量随机变量和其数学期望（即均值）之间的偏离程度。
设$X$为随机变量，如果$E{[X-E(X)]^2}$存在，则称$E{[X-E(X)]^2}$为$X$的方差，记为$Var(X)$。
$$Var(X)=E(X^{2})-[E(X^{2})]$$
例3. 计算样本(2,5,78,45,89,124)的方差
```{r}
s <- c(2,5,78,45,89,124)
var(s)
```
###众数(Mode)
观察资料中出现次数最多的数值或类别，不受极值影响，由于可能有不只一个也可能沒有众数，一般不适合进行统计分析。
例4. 计算样本(4,22,31,33,3,27,27,27,27,569,110,8,21,31,33,33)的众数
```{r}
S <- c(4,22,31,33,3,27,27,27,27,569,110,8,21,31,33,33)
names(which.max(table(S)))
```
###协方差(Covariance)
协方差用于衡量两个变量的总体误差。而方差是协方差的一种特殊情况，即当两个变量是相同的情况。设$X$,$Y$为两个随机变量，称$E{[X-E(X)][Y-E(Y)]}$为$X$和$Y$的协方差，记录$Cov(X,Y)$。
$$Cov(X,Y)=E\left \{ [X-E(X)][Y-E(Y)] \right \}$$
例5. 计算X(2,5,7)和Y(6,7,9)的协方差。
```{r}
x <- c(2,5,7)
y <- c(6,7,9)
cov(x,y)
```
###相关系数(Correlation coefficient)
相关系数是用以反映变量之间相关关系密切程度的统计指标。相关系数是按积差方法计算，同样以两变量与各自平均值的离差为基础，通过两个离差相乘来反映两变量之间相关程度。当$Var(X)>0, Var(Y)>0$时，称$Cov(X,Y)/sqrt(Var(X)*Var(Y))$为$X$与$Y$的相关系统。
$$\rho (X,Y)=\frac{Cov(X,Y)}{\sqrt{Var(X)Var(Y)}}$$
例6. 计算X(2,5,7)和Y(6,7,9)的相关系数
```{r}
x <- c(2,5,7)
y <- c(6,7,9)
cor(x,y)
```
### 偏度(skewness)
是统计数据分布偏斜方向和程度的度量，是统计数据分布非对称程度的数字特征。设分布函数$F(x)$有中心矩$\mu_{2}=E(X-E(X))^2$,$\mu_{3}=E(X-E(X))^3$,则$\frac{\mu_{3}}{\mu_{2}^{\frac{3}{2}}}$为偏度系数。当$C_{s}$>0时，概率分布偏向均值右则,$C_{s}$<0时，概率分布偏向均值左则。
$$C_{s}=\frac{\mu_{3}}{\mu_{2}^{\frac{3}{2}}}$$

###峰度(kurtosis)
表征概率密度分布曲线在平均值处峰值高低的特征数。峰度刻划不同类型的分布的集中和分散程序。设分布函数$F(x)$有中心矩$\mu_{2}=E(X-E(X))^2$, $\mu_{4}=E(X-E(X))^4$，则$C_{k}=\frac{\mu_{4}}{\mu_{2}^{2}}-3$为峰度系数。
$$C_{k}=\frac{\mu_{4}}{\mu_{2}^{2}}-3$$
例7. 计算10000个正态分布的样本的偏度和峰度
```{r}
S<-rnorm(10000)
skewness(S)
kurtosis(S)
hist(S,breaks=100)
```

###几何平均数（Geometric mean）
是n个变量值连乘积的n次方根,是用于反映一组经对数转换后呈对称分布的变量值在数量上的平均水平即对数正态分布数据，在医学研究中常适用于免疫学的指标。对于变量值呈倍数关系或呈对数正态分布（正偏态分布），如抗体效价及抗体滴度，某些传染病的潜伏期，细菌计数等，宜用几何均数表示其平均水平。
$$H=G=\sqrt[n]{X_{1}*X_{2}*...*X_{n}}=\sum \sqrt[n]{\prod_{i=1}^{n}X_{n}}$$
例8. 5名学龄儿童的麻疹血凝抑制抗体滴度为1：25，1：50，1：50，1：100，1：400，求几何均数及标准差。
```{r}
geomean <- function(x, na.rm = FALSE, trim = 0, ...)
{
  exp(mean(log(x, ...), na.rm = na.rm, trim = trim, ...))
}
geosd <- function(x, na.rm = FALSE, ...)
{
  exp(sd(log(x, ...), na.rm = na.rm, ...))
}
s<-c(25,50,50,100,400)
geomean(s)
geosd(s)
```
也可以安装NCStats包，调用geomean和geosd()函数。

###变异系数（Coefficient of Variation）
是刻画数据相对分散性的一种度量，记为$c_v$,是概率分布离散程度的一个归一化量度，其定义为标准差$\ \sigma$与平均值$\ \mu$ 之比
$$c_v = {\sigma \over \mu }$$

###样本校正平方和（CSS）
样本与均值差的平方的求和$CSS=\sum_{i=1}^{n}(x_{i}-\overline{x})$

###样本未校正平方和（USS）
样本值平方的求和$USS=\sum_{i=1}^{n}x_{i}^{2}$

###标准误（Standard Deviation）
是某种统计量在抽样分布上的标准差称为该种统计量的标准误，即样本统计量的标准差，是描述对应的样本统计量抽样分布的离散程度及衡量对应样本统计量抽样误差大小的尺度。设n个测量值的误差为v1、v2……vn，则这组测量值的标准误差$\sigma$
$$\sigma =\sqrt{\frac{1}{n-1}\sum_{i=1}^{n}v_{i}^2}$$

###极差
描述样本分散性，数据越分散，其极差越大。
$$R=max(x)-min(x)$$

例8. 对例1求变异系数、样本校正平方和、样本未校正平方和、极差和均值的标准误。
```{r}
cv <- 100*sd(sbp)/mean(sbp)
cv
css <- sum((sbp-mean(sbp))^2)
css
uss <- sum(sbp^2)
uss
r <- max(sbp)-min(sbp)
r
```
通常由于总体的均数或总体的方差并不知道，样本均值的标准误$SD=\frac{s}{\sqrt{n}}$,s为标准差，n为样本数。
```{r}
sd <- sd(sbp)/sqrt(length(sbp))
sd
```




