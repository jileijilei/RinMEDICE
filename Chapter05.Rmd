---
title: "假设检验"
author: "梁雪枫"
date: "2014年11月18日"
documentclass: ctexart
output:
  pdf_document:
    fig_caption: yes
    latex_engine: xelatex                               
    number_sections: yes
    template: !expr rticles::ctex_template()
    toc: yes
classoption: "hyperref`r if (.Platform$OS.type != 'windows') ',nofonts'`"
---

```{r include=FALSE}
library(vcd)
library(pander)
```

假设检验（hypothesis test），就是根据已掌握的资料对一个总体参数是否等于某一个数值，某一随机变量是否服从某种概率分布的假设，然后根据所取得的样本资料，利用一定的统计方法计算出有关检验的统计量，依据一定的概率原则，以较小的风险来判断估计数值与总体数值（或估计分布与实际分布）是否存在显著差异，是否应当接受原假设的一种检验方法。假设检验是根据小概率事件的实际不可能性原理来推断的。假设检验中的小概率标准称为显著性水平，用$\alpha$表示。依据显著性水平的大小将检验统计量的所有可能值组成的样本空间分为两个区域 ：否定域或拒绝域：在原假设成立的情况下，如果检验统计量的值落在这个区域里，则否定原假设。接受域：在原假设成立的情况下，如果检验统计量的值没有落在这个区域里，则接受原假设。 假设检验的步骤:1. 建立统计假设,包括原假设,备择假设。2. 确立合适的检验统计量，确定其分布。3. 规定显著性水平 4. 根据样本观测值计算检验，统计量的取值。5. 判断原假设是否成立。假设检验的四种情况

                          $H_{0}$为真         $H_{0}$为假 
---                      ---                  --- 
接受$H_{0}$              正确决策              第二类错误 $\beta$
拒绝$H_{0}$              第一类错误$\alpha$    正确决策 

第一类错误，也称弃真错误,本来是真的，却根据检验统计量的值把它给否定了。发生这种错误的概率通常用$\alpha$表示。第二类错误，也称取伪错误，本来是假的，却根据检验统计量的值把它给接受了。

##参数假设检验
参数假设检验，是指在总体的分布形式已知的条件下，对总体参数的某一假设进行的检验 。
###正态总体均值的假设检验
####单个总体的情况及实例
当总体分布为正态分布，总体标准差为已知时，检验所使用的检验统计量为$z=\frac{\bar{x}-\mu _{0}}{\sigma _{0}/\sqrt{n}}\sim N(0,1)$。$\sigma$为总体方差，$\mu _{0}$为总体均数，$n$为样本数，$\bar{x}$为样本均数。
在总体方差未知的情况下，用样本方差$S$代替总体$\sigma$,检验统计量为$t=\frac{\bar{x}-\mu _{0}}{S/\sqrt{n}}\sim t(n-1)$

例1 某药厂生产一批新的药品，规定直径为10mm,方差为0.4。为了检验机器的性能是否良好，随机抽取了25件产品，测得其平均长度为9.30  9.32 10.41  9.06 10.21  9.31  9.96  9.03 10.22  9.19 10.36  9.67 10.43 10.36  9.83 10.67 10.38 9.29  9.74  9.99  9.98  9.89  9.52  9.88  9.67。假设生产的药品直径服从正态分布，问在显著性水平0.05时，该机器的性能是否良好。
```{r}
z.test<-function(x,sigma,alpha,u0=0,alternative="two.sided"){
  n <- length(x)
  options(digits=4)
  result<-list( )
  mean<-mean(x)
  z<-(mean-u0)/(sigma/sqrt(n))
  p<-pnorm(z,lower.tail=FALSE)
  result$mean<-mean
  result$z<-z
  result$p.value<-p
  if(alternative=="two.sided"){
    p<-2*p
    result$p.value<-p
  }
  else if (alternative == "greater"|alternative =="less" ){
    result$p.value<-p
  }
  else return("your input is wrong")
  result$conf.int<- c(
    mean-sigma*qnorm(1-alpha/2,mean=0, sd=1,
                     lower.tail = TRUE)/sqrt(n),
    mean+sigma*qnorm(1-alpha/2,mean=0, sd=1,
                     lower.tail = TRUE)/sqrt(n))
  result
}

x <- c(9.30,9.32,10.41,9.06,10.21,9.31,9.96,9.03,10.22
       ,9.19,10.36,9.67,10.43,10.36,9.83,10.67,10.38,9.29,
       9.74,9.99,9.98,9.89,9.52,9.88,9.67)

z.test(x,0.4,0.05,10)

```

例2 假设例1的总体方差未知，假设生产的药品直径服从正态分布，问在显著性水平0.05时，该机器的性能是否良好。
```{r}
t.test(x,alternative = "two.sided",mu=10)
```

####两个总体的情况及实例
两个总体为正态分布，方差已知,检验所使用的检验统计量为$z=\frac{(x_{1}-x_{2})-(u_{1}-u_{2})}{\sqrt{\frac{\sigma_{1}^{2}}{n_{1}}+\frac{\sigma_{1}^{2}}{n_{2}}}}\sim N(0,1)$

两个总体为正态分布，方差未知,检验所使用的检验统计量为$T=\frac{(x_{1}-x_{2})-(u_{1}-u_{2})}{\sqrt{\frac{S^{2}}{n_{1}}+\frac{S^{2}}{n_{2}}}}\sim t(n_{1}+n_{2}-2)$

例3 制药厂试制某种安定神经的新药，两台仪器制造药品服从正态分布，从各自加工药品中，分别取若干个测量其直径，两组直径如下A组 20.5 19.8 19.7 20.4 20.1 20.0 19.0 19.9 B组 20.7 19.8 19.5 20.8 20.4 19.6 20.2，问两台仪器的加工精度有无显著差异？
```{r}
x<-c(20.5, 19.8, 19.7, 20.4, 20.1, 20.0, 19.0, 19.9)
y<-c(20.7, 19.8, 19.5, 20.8, 20.4, 19.6, 20.2)

t.test(x, y, var.equal=TRUE)
```

###总体比例的假设检验
####单样本率的检验
样本率与总体率比较的目的，是推断该样本所代表的未知总体率π与已知总体率$\hat{p}$ 是否不同。 当样本含量$n$足够大，且样本率$p_{0}$ 和$1-p_{0}$均不太小，如 $np_{0}$与$n(1-p_{0})$均大于5 时，样本率的分布近似正态分布统计量$Z=\frac{\hat{p}-p_{0}}{\sqrt{p_{0}(1-p_{0})}}\sim N(0,1)$。当$np_{0}$与$n(1-p_{0})$均小于5时，样本率的分布近似二项分布。

例4 按照以往经验，新生儿染色体异常率一般为1%，某医院观察了当地400名新生儿，有一例染色体异常，问该地区新生儿染色体是否低于一般水平？

```{r}
binom.test(1,400,p=0.01,alternative="less")

#样本量较小时，不宜选择prop.test(),有警告！
prop.test(1,400,p=0.01,alternative="less")
```
P值大于0.05，尚不能认为该地区新生儿染色体异常低于一般水平。

####两样本率的检验
两个总体比例$hat{p_{1}}$和$hat{p_{1}}$的极大似然估计分别为近似地服从正态分布:
  $Z=\frac{\hat{p_{1}}-\hat{p_{2}}}{\sqrt{(n_{1}+n_{2})\hat{p}(1-\hat{p})/n_{1}n_{2}}}$,$\hat{p}=\frac{n_{1}\hat{p_{1}}+n_{2}\hat{p_{2}}}{n_{1}+n_{2}}$
  
例5 某综合医院随机抽取了345个男病例与451个女性病例调查吸烟的暴露情况, 调查结果为187个男性病例与76女性病例中有吸烟的暴露, 能否认为男、女病例吸烟的暴漏一致?

```{r}
s <- c(187,76)
t <- c(345,451)
prop.test(s,t)
```
P值较小，可以认为男女病例的吸烟暴漏情况不同。

##非参数假设检验
非参数假设检验，是指在总体分布未知时，对其分布的具体形式、特征值等信息进行的假设检验。
###Pearson拟合优度$\chi ^{2}$检验
假定某随机变量$X$应当有分布，对$X$进行$n$次观察，可以得到Pearson$\chi^{2}$统计量$K=\sum_{i=1}^{m}\frac{(n_{i}-np{i})^{2}}{np_{i}}$,当$n\rightarrow \infty$时，$K$分布收敛于自由度为$m-1$的$\chi ^{2}$分布。$m$为区间个数，$n_{i}$为随机变量落在区间内的个数，$p_{i}$为区间的理论概率。

例6 20位病人的某项临床检验值如下9.66 35.42 39.24 32.00  6.63 27.96 20.79 17.81 19.97 13.03 35.93 13.30 32.39 23.21 31.35 16.98 20.56 16.94 35.21 23.33，请用Pearson $\chi ^{2}$检验判断是否服从正态分布？

```{r}
 x <- c(9.66,35.42,39.24,32.00,6.63,27.96,20.79,
        17.81,19.97,13.03,35.93,13.30,32.39,23.21,
        31.35,16.98,20.56,16.94,35.21,23.33)
 g <- table(cut(x,breaks = c(5,10,15,20,25,30,35)))
 p <- pnorm(c(10,15,20,25,30,35),mean(x),sd(x))
 p <- c(p[1],p[2]-p[1],p[3]-p[2],p[4]-p[3],p[5]-p[4],1-p[5])
 chisq.test(g,p = p)

```
P值大于0.05，可以认为服从正态分布
###Kolmogorov-Smirnov检验
Kolmogorov-Smirnov是比较一个频率分布f(x)与理论分布g(x)或者两个观测值分布的检验方法。其原假设$H_{0}$:两个数据分布一致或者数据符合理论分布。 $D=max|f(x)-g(x)|$,当实际观测值$D>D(n,\alpha)$则拒绝$H_{0}$，否则则接受$H_{0}$假设。检验统计量为$Z=\sqrt{n}\max_{i}(|F_{n}(x_{i-1}-F(x_{i})|,|F_{n}(x_{i}-F(x_{i})|)$。
####单样本检验

例7 20位病人的某项临床检验值如下9.66 35.42 39.24 32.00  6.63 27.96 20.79 17.81 19.97 13.03 35.93 13.30 32.39 23.21 31.35 16.98 20.56 16.94 35.21 23.33，请用Kolmogorov-Smirnov检验判断是否服从正态分布？
```{r}
x <- c(9.66,35.42,39.24,32.00,6.63,27.96,20.79,17.81,
       19.97,13.03,35.93,13.30,32.39,23.21,31.35,16.98,
       20.56,16.94,35.21,23.33)
ks.test(x,mean(x),sd(x))
```
P值大于0.05，可以认为服从正态分布
####两样本检验

例8 测定两组病人尿液中的尿胆原（URO），A组 2.13 13.91 15.65 12.34  0.74 10.49  7.22  5.86  6.84  3.67 B组 4.62  6.16 0.52  4.79 0.21  3.69  3.46  3.42  5.67  2.83，请检验A组和B组是否相同？

```{r}
a <- c(2.13,13.91,15.65,12.34,0.74,10.49,7.22,5.86,6.84,3.67)
b <- c(4.62,6.16,0.52,4.79,0.21,3.69,3.46,3.42,5.67,2.83)
ks.test(a,b)
```
P值大于0.05，可以认为A、B两组相同。

###列联表的独立性检验
在研究问题时有时候会遇到要求判断两个分类变量之间是否存在联系的问题，通常使用$\chi ^{2}$检验判断两组或多组资料是否相互关联。如果不相互关联，就称为独立，这类问题处理称为独立性检验（Test of Independence）。

####Pearson$\chi ^{2}$检验
在$i$为行，$j$为列的列联表中，统计量为$K=\sum_{i=1}^{I}\sum_{j=1}^{J}\frac{[n\cdot n_{ij}-n_{i}\cdot n_{j}]^{2}}{n\cdot n_{i}\cdot n_{j}}$。

例9 vcd包中Arthritis数据集是一项风湿性关节炎新疗法的双盲临床实验的结果，请分析治疗措施是否与风湿性关节炎改善情况有关？
```{r}
panderOptions('table.split.table', Inf)
pander(head(Arthritis))
```
```{r}
mytable <- xtabs(~Treatment+Improved,data=Arthritis)
chisq.test(mytable)
```
P值小于0.05，可以认为治疗情况与改善状况有关。

例10 某杂志刊登了一篇研究吸烟是否与患肺癌有关文章，对63位肺癌患者及43名非肺癌患者调查了其中的吸烟人数，得到2*2列联表，如下表所示，认为吸烟与肺癌有关，请予以验证！

               患肺癌          未患肺癌
---            ---             --- 
吸烟            60             32
不吸烟          3              11

```{r}
x<-c(60, 3, 32, 11)
dim(x)<-c(2,2)
chisq.test(x,correct = FALSE)
```
P值小于0.05，可以认为吸烟与肺癌有关。

####Fisher精确独立检验
在样本较小时（单元的期望频数小于5），需要用Fisher精确检验来做独立性检验。

例11 对例9进行Fisher精确独立检验。

```{r}
mytable <- xtabs(~Treatment+Improved,data=Arthritis)
fisher.test(mytable) #fish.test()函数不可用于2*2列联表
```

####Cochran-Mantel-Haenszel检验
在存在第三个分类变量的情况下，有条件的检验两个分类变量的关联度，需要用Cochran-Mantel-Haenszel检验。其原假设是两个分类变量在第三个变量的每一层中都是条件独立的。

例12 Arthritis数据集检验治疗情况和改善情况在性别的每一水平下是否独立，假设不存在三阶交互作用（治疗情况×改善情况×性别）。

```{r}
mytable <- xtabs(~Treatment+Improved+Sex,data=Arthritis)
mantelhaen.test(mytable)
```
P值较小，表明接受治疗与得到改善在性别的每一水平下并不独立即，分性别来看，用药治疗的患者叫接受安慰剂的患者有了更多的改善。


####相关性度量
常用phi系数(Phi-Coefficient)描述$2*2$(四格表)数据相关程度，$\varphi =\sqrt{x^{2}/n}$,$n$总频数；列联系数(Contingency Coefficient)主要用于大于$2*2$的列联表，$C=\sqrt{\frac{x^{2}}{x^{2}+n}}$；Cramer's V系数,$V =\sqrt{\frac{x^{2}}{n*\min[(R-1),(C-1)]}}$;可用vcd包中的assocstats()函数计算。

```{r}
mytable <- xtabs(~Treatment+Improved,data=Arthritis)
assocstats(mytable)
```


####McNemar检验
McNemar检验用于配对计数资料的分析，主要分析配对资料中对照组和处理组的频数或比率是否有差异，也可以分析统一批观察对象用药前后或试验前后的结果是否有差异，并不是独立性检验。Kappa统计量用于测量两次调查的可重复性，$k=\frac{p_{0}-p_{e}}{1-p_{e}}$,$p_{0}$两次调查中一致的概率，$p_{e}$两次调查的期望一致概率，$p_{e}= \sum_{i=1}^{c}a_{i}b_{i}$，$a_{i}b_{i}$为$c*c$列联表中两个调查第$i$个类型的边际概率,k>0.75表示极好的重复性,0.4<=k<=0.75好的重复性,0<=k<0.4边界(勉强够格)的重复性。

例13 研究人员将患霍奇金淋巴瘤的病人和非病人按同性别及年龄在5岁以内的条件进行配对，共配对85对病人。两组人群中扁桃体切除情况如下，试问配对的两组人群扁桃体切除率是否有差别？

             对照是       对照否
----         ---         --- 
病人是       26          15 
病人否       7           37

```{r}
x <- c(26,7,15,37)
dim(x) <- c(2,2)
mcnemar.test(x,correct=F)
```
P值大于0.05，不能认为两组人群扁桃体切除率有差异。

例14 同时使用甲乙两种方法测定265份标本中的金黄色葡萄球菌，结果如下，问甲乙两种方法可重复性(kappa)是多少？

             甲+         甲-
----         ---         --- 
乙+          107         35 
乙-          24          99

```{r}
kappa.test <- function(x)
{
  N=sum(x)
  Po=sum(diag(x)/N) #观察到的一致数
  mr=apply(x,1,sum) #行边际
  mr=mr/N
  mc=apply(x,2,sum) #列边际
  mc=mc/N
  Pe=sum(mc * mr) #期望一致数
  k=(Po-Pe)/(1-Pe) #kappa统计量
  se_k = sqrt((Pe+Pe^2-sum(mr*mc*(mr+mc)))/(N*(1-Pe)^2)) # kappa统计量的标准误
  z=k/se_k #检验统计量
  p.value=1-pnorm(z) # p值
  res=list(kappa=k,se_k=se_k,p.value=p.value,z=z)
}

X<-c(107, 24, 35, 99)
dim(X)<-c(2,2)
k <- kappa.test(X)
k
```

###符号检验
符号检验（sign test）是根据正、负号的个数来假设检验。首先将原始观察值按设定的规则，转换成正、负号，然后用二项分布B（n，1/2）计数正、负号的个数的概率作出检验。该检验可用于样本中位数和总体中位数的比较，数据的升降趋势的检验，特别适用于总体分布不服从正态分布或分布不明的配对资料。

例15 乙型脑炎病例在25个不同三甲医院的治疗费用（元）如下：15165  4257 25844 36779  4730 14687  2901 13964 16226 25004 37086  2193 31139  4057 34443 37572  6260  2754 18377 39357 29184 17398  9948 13938 32874试用符号检验分析，某三甲医院治疗费(10000元)用是在中位数之上还是之下。

样本的中位数(M)作为治疗费用的中间值，$H_{0}$:M>10000,$H_{1}$:M<10000。

```{r}
x <- c(15165,4257,25844,36779,4730,14687,2901,13964,
       16226,25004,37086,2193,31139,4057,34443,37572,6260,2754,
       18377,39357,29184,17398,9948,13938,32874)
binom.test(sum(x>10000),n = length(x),alternative = "l")

```
P值大于0.05，可以认为样本的中位数大于10000元，也就是说某三甲医院治疗费用（10000元）在中位数之下。

例16 为豚鼠注入肾上腺素前后的每分钟灌流滴数，给药前：30 38 48 48 60 46 26 58 46 48 44 46，给药后：46 50 52 52 58 64 56 54 54 58 36 54，试比较给药前后灌流滴数有无显著差别？

```{r}
x <- c(30,38,48,48,60,46,26,58,46,48,44,46)
y <- c(46,50,52,52,58,64,56,54,54,58,36,54)
binom.test(sum(x<y),length(x))
```
P值大于0.05，可认为给药前后无显著差异。

###秩相关检验
在R软件中，使用rank()函数计算秩统计量。
####Spearman秩相关检验
当X和Y相互独立时，$r_{i}$为X产生的秩统计量，$R_{i}$为Y产生的秩统计量，Spearman秩相关系数为$r_{s}=[\frac{1}{n}\sum r_{i}R_{i}-(\frac{n+1}{x})^{2}]/(\frac{n^{2}-1}{12})
$。

例17 两位评分员对新出生的5名新生儿进行Apgar评分，甲：6  7  8  9 10，乙：5  6  7  8 10。试用Spearman秩相关检验方法检验两个评分员对等级评定有无相关关系。
```{r}
x <- c(6,7,8,9,10)
y <- c(5,6,7,8,10)
cor.test(x,y,method = "spearman")
```
P值小于0.05，可以认为两位评分员结论有关。

####Kendall秩相关检验
从两变量是否协同（concordant）来检验变量之间的相关性，如果$(x_{j}-x_{i})(y_{j}-y_{i})>0$则对子协同，如果$(x_{j}-x_{i})(y_{j}-y_{i})<0$则对子不协同。Keandall $\tau$相关系数$\hat{\tau }=\frac{n_{d}-n_{c}}{C_{n}^{2}}$,$n_{d}$是不协同的对子数目，$n_{c}$是能够协同的对子数目。

例18 欲研究体重和肺活量的关系，调查某地10名初中女生的体重和肺活量如下，进行相关性检验。体重:75 95 85 70 76 68 60 66 80 88,肺活量：2.62 2.91 2.94 2.11 2.17 1.98 2.04 2.20 2.65 2.69。

```{r}
x <- c(75,95,85,70,76,68,60,66,80,88)
y <- c(2.62,2.91,2.94,2.11,2.17,1.98,2.04,2.20,2.65,2.69)
cor.test(x,y,method = "kendall")
```
P值小于0.05，可以认为体重和肺活量是相关的，且为正相关。

###Wilcoxon秩检验
符号检验利用了观察值和原假设的中心位置之差的符号来进行检验, 但是它并没有利用这些差的大小，Wilcoxon秩检验比符号检验多利用差的大小(体现于差的绝对值的大小)所包含的信息。
####单个总体样本检验

例19 已知某地正常人尿氟含量的中位数为2.15mmol/L。今在该地某厂随机抽取12名工人，测得尿氟含量（mmol/L），结果如下2.15 2.10 2.20 2.12 2.42 2.52 2.62 2.72 2.99 3.19 3.37 4.57。问该厂工人的尿氟含量是否高于当地正常人？

$H_{0}$:M>2.15,$H_{1}$:M<2.15。

```{r}
x <- c(2.15,2.10,2.20,2.12,2.42,2.52,2.62,2.72,2.99,3.19,3.37,4.57)
wilcox.test(x,alternative = "l",mu = 2,15)
```
P值大于0.05，接受原假设，认为该工厂的尿氟含量高于当地正常人。

####配对样本比较的Wilcoxon

配对设计计量资料两处理效应的比较，一般采用配对t检验，如果差数严重偏离正态分布，可采用Wilcoxon秩检验，亦称符号秩和检验（signed rank test）。一般认为，在数据满足配对t检验要求时，Wilcoxon秩检验的功效是检验效能的95%左右。目的是推断配对样本差值的总体中位数是否和0有差别，即推断配对的两个相关样本所来自的两个总体中位数是否有差别。

例20 某研究者欲研究保健食品对小鼠抗疲劳作用，将同种属的小鼠按性别和年龄相同、体重相近配成对子，共10对，并将每对中的两只小鼠随机分到保健食品两个不同的剂量组，过一定时期将小鼠杀死，测得10对小鼠肝糖原含量（mg/100g）中剂量组620.16 866.50 641.22 812.91 738.96 899.38 760.78 694.95 749.92 793.94 高剂量组958.47 838.42 788.90 815.20 783.17 910.92 758.49 870.80 862.26 805.48，问不同剂量组的小鼠肝糖原含量有无差别？


```{r}
x <- c(620.16,866.50,641.22,812.91,738.96,899.38,760.78,694.95,749.92,793.94)
y <- c(958.47,838.42,788.90,815.20,783.17,910.92,758.49,870.80,862.26,805.48)
wilcox.test(x,y,paired = T)
```
P值小于0.05，可以认为该保健食品的不同剂量对小鼠肝糖原含量的作用不同。

####样本比较的Wilcoxon
#####两组连续变量资料的秩和检验

例21 在某项研究中，经随机抽样获得甲乙两组病人的血尿素氮(BUN)mmol/L，甲组:4.98  3.90  4.02  0.68  4.98  5.04 1.20  2.64  6.23  3.00,乙组：4.17 4.95 3.96 3.59 4.89 3.03 3.71 5.91 5.55 6.29 4.82 3.90 6.11，试比较甲乙组病人血尿素氮(BUN)的含量有无差别？
 
```{r}
x <- c(4.98,3.90,4.02,0.68,4.98,5.04,1.20,2.64,6.23,3.00)
y <- c(4.17,4.95,3.96,3.59,4.89,3.03,3.71,5.91,5.55,6.29,4.82,3.90,6.11)
wilcox.test(x,y,exact = FALSE,correct =F) 
wilcox.test(x,y,exact = FALSE) 
```
无论是否采用连续校正，P值均大于0.05，不能拒绝原假设，可以两组病人血尿素氮无差异。

#####两组有序变量资料的秩和检验

例22 某研究者欲评价新药按摩乐口服液治疗高甘油三脂血症的疗效，将高甘油三脂血症患者189例随机分为两组，分别用按摩乐口服液和山楂精降脂片治疗，数据见下表，问两种药物治疗高甘油三脂血症的疗效有无不同？

疗效          按摩乐口服液       山楂精降脂片
----          ---                ---
无效          17                 70
有效          25                 13
显效          37                 37

```{r}
a <- rep(1:3,c(17,25,27))
b <- rep(1:3,c(70,13,37))
wilcox.test(a, b, exact=FALSE)
```
P值小于0.05，可以认为，两种药物对高甘油三脂血症的疗效分布不同。

#####多组连续变量资料的秩和检验

例23 三名评分员对10名测试的分别打分如下：A：1 2 5 3 2 1 1 3 2 1，B：4 3 6 5 2 6 1 6 5 4，C：9,6,7,7,5,1,8,9,6,5，问不同的评分员之间是否有差异？
```{r}
Value <- c(1,2,5,3,2,1,1,3,2,1,4,3,6,5,2,6,1,6,5,4,9,6,7,7,5,1,8,9,6,5)
Group <- factor(c(rep(1,10),rep(2,10),rep(3,10)))
data <- data.frame(Group, Value)

kruskal.test(Value ~ Group, data=data)
```
P值小于0.05，可以认为，三位评员的评分分布不同。

####完全随机设计多个样本比较的Kruskal-Wallis 

例24 下面的数据是游泳、打篮球、骑自行车等三种不同的运动在30分钟内消耗的热量(单位:卡路里). 这些数据是否说明这三种运动消耗的热量全相等?游泳: 306, 385, 300, 319, 320;打篮球: 311, 364, 315, 338, 398;骑自行车: 289, 198, 201, 302, 289.

```{r}
x<-list(swim=c(306, 385, 300, 319, 320),
basketball=c(311, 364, 315, 338, 398),
bicycle=c(289, 198, 201, 302, 289))
kruskal.test(x)
```

####随机区组设计多个样本比较的Friedman
例25 现有6条狗服用阿司匹林不同时间（时间）血中的药物浓度数据（r/ml）如下表，问服药后不同时间血中的药物浓度有无差别？

编号  0.5h  1h    6h     8h     24h   48h
----  ---   ---   ---    ---    ---   ---
1     51.6  135.2 169.8  137.2  31.9  0.4
2     49.6  101.6 158.4  133.0  18.7  0.0
3     40.6  88.4  142.8  126.6  18.1  2.0
4     11.2  37.2  131.8  130.3  17.5  0.2
5     17.8  48.2  118.0  124.5  18.7  1.8
6     14.4  41.6  120.8  123.5  24.8  3.0

```{r}
x<-matrix(c(51.6,49.6,40.6,11.2,17.8,14.4,
           135.2,101.6,88.4,37.2,48.2,41.6,
           169.8,158.4,142.8,131.8,118,120.8,
           137.2,133,126.6,130.3,124.5,123.5,
           31.9,18.7,18.1,17.5,18.7,24.8,
           0.4,0,2,0.2,1.8,3
          ),
         nrow = 6,
         byrow = TRUE,
         dimnames = list(1 : 6,c("h1", "h2", "h3","h4","h5","h6")))

friedman.test(x)
```
P值小于0.05，拒绝原假设，可以认为服药后不同时间血中的药物浓度有差异

例26 A、B两种药物治疗后，测得体重相近的三组患儿的血肌酐含量如下，每组2名，问A、B两种药物对患儿的血肌酐含量的影响是否有差异？

药物   区组   血浆蛋白
----   ---    ---
 A     L      44.55
 B     L      28.22
 A     M      24.00
 B     M      28.77
 A     H      24.55
 B     H      18.77
 
 
```{r}
w <- as.factor(c("A","B","A","B","A","B"))
t <- as.factor(c("L","L","M","M","H","H"))
x <- c(44.55,28.22,24.00,28.77,24.55,18.77)
wb <- as.data.frame(cbind(x,w,t))
friedman.test(x ~ w | t, data = wb)
```
P值大于0.05，不能拒绝原假设，可以认为A、B两种药物对患儿的血肌酐含量影响无差异。

###将表转化为扁平格式
例27 期刊中经常发表如下表格，请將表中的数据扁平化格式保存。

治疗情况         无改善         一定程度改善          显著改善
----             ---            ---                   ---
安慰剂治疗       29             7                     7
药物治疗         13             17                    21

```{r}
table2flat <- function(mytable){
  df <- as.data.frame(mytable)
  rows <- dim(df)[1]
  cols <- dim(df)[2]
  x <- NULL
  for(i in 1:rows){
    for(j in 1:as.integer(as.character(df$Freq[i]))){
      row <- df[i,c(1:(cols-1))]
      x <- rbind(x,row)
    }
  }
  row.names(x) <- c(1:dim(x)[1])
  return(x)
}

treatment <- rep(c("Placebo","Treated"),times=3)
improved <- rep(c("None","Some","Marked"),each=2)
Freq <- c(29,13,7,17,7,21)
mytable <- as.data.frame(cbind(treatment,improved,Freq))

mydata <- table2flat(mytable)
```


