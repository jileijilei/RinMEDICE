---
title: "回归分析"
author: "梁雪枫"
date: "2014年12月10日"
documentclass: ctexart
output:
  pdf_document:
    fig_caption: yes
    latex_engine: xelatex
    number_sections: yes
    template: !expr rticles::ctex_template()
    toc: yes
classoption: "hyperref`r if (.Platform$OS.type != 'windows') ',nofonts'`"
---

```{r include=FALSE}
library(pander)
library(ggplot2)
library(pspearman)
```
回归分析通过建立函数表达式，用一个或者多个自变量的变化解释或预测因变量，常用于描述、探索和检验自变量和因变量之间因果关系，根据自变量的变化预测因变量的取值。通常按照自变量的个数划分为一元回归和多重回归。按照函数表达式的形式，分为线性回归和非线性回归。

##一元线性回归
假设有两个变量X和Y，X为自变量，Y为因变量。则一元线性回归模型的基本结构形式为$$Y=\beta _{0}+\beta _{1}X+\varepsilon $$。$\varepsilon$是误差项，表示未知或不易测量的随机因素对因变量影响的总和。$\beta _{0}$为回归的常数，$\beta _{1}$为回归系数，它表示增加和减少一个单位时，Y的平均变化量。线性回归就是根据已经观测到的样本数据，应用最小二乘法获得对$\beta _{0}$和$\beta _{1}$的估计，进而得到回归方程。由于参数估计时并不知道是否存在线性关系，回归方程在应用前需要完成对回归方程的检验，即对回归模型的系数是否为零进行检验。常用t检验、F检验和相关系数检验评价回归方程的回归系数是否为0。
线性回归应用有四个前提条件：线性、独立、正态和方差齐性。线性指自变量和因变量在散点图大致呈直线趋势。独立性值观察值之间应相互独立。正态性指残差应符合正态分布。方差齐性指在自变量取值范围内，对于自变量的取值，因变量都有相同的方差。

例1 某医生分别采用盐析法和结合法测定正常皮肤中胶原蛋白的含量。盐析法只能部分提纯，结合法较为复杂单精确。该医生欲寻求找盐析法和结合法之间的关系，以便通过盐析法预测结合法的测定值。

编号   
----   --- --- --- --- --- --- ---  ---  ---  ---  ---  ---  ---  ---  ---
盐析法 6.8 7.8 8.7 8.7 8.9 9.5 10.1 10.2 10.3 10.4 11.1 12.4 13.3 13.1 13.2
结合法 546 553 562 563 570 575 581  605  607  621  624  626  632  640  656

解 首先对线性回归的应用条件进行检验。
线性条件可通过散点图直接观察。
```{r}
y <- c(546,553,562,563,570,575,581,605,607,621,624,626,632,640,656)
x <- c(6.8,7.8,8.7,8.7,8.9,9.5,10.1,10.2,10.3,10.4,11.1,12.4,13.3,13.1,13.2)
df <- as.data.frame(cbind(x,y))

#ggplot(df,aes(x,y))+geom_point()+stat_smooth(method = "lm")
plot(x,y)
```
通过散点图，可以发现二者近似直线关系，符合线性条件。

残差的正态性检验
```{r}
model <- lm(y~x)
shapiro.test(residuals(model))
```
正态性检验结果表明W值为`r shapiro.test(residuals(model))$statistic`，P值为`r shapiro.test(residuals(model))$p.value`,c残差符合正态分布。

方差齐性
```{r}
plot(predict(model),rstandard(model))
```
所有的学生化残差均在$\pm 2$在范围内波动，没有明显的上升或下降趋势，可以认为符合方差齐性。也可以通过自变量与残差绝对值的等级相关来检验。

```{r}
spearman.test(x,abs(residuals(model))) #R中pspearman包中的spearman.test函数可以完成斯皮尔曼等级相关检验

#cor.test(x,abs(residuals(model)),method="spearman")
```
自变量与残差绝对值的等级相关系数为0.47,P值大于0.05，无统计学意义，可以认为残差方差齐性。



